{% extends 'base.html' %}


{% block head %}
    <title>Loading Histogram</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="jquery-3.7.1.min.js"></script>
    <script>
        const speciesList = {{ species_list|safe }};
        const fitOnScreen = '{{ fit_on_screen|safe }}';
        const searchTerm = '{{ search_term|safe }}';
        var domainsOfInterest = {{ domains_of_interest|safe }};
        var frequencyDictList;
        
        $(document).ready(function(){
            $("#results").text("test");
            $.ajax({
                url: "https://zr25ojb4do7qu6usoihbljlhbe0vcsif.lambda-url.us-west-1.on.aws/",
                processData: false,
                crossDomain: true,
                type: "POST",
                data: JSON.stringify({
                    species_selection: speciesList,
                    domain: domainsOfInterest.pop(),
                }),
                cache: false,
                processData: false,
                success: function(result){
                    $("#remaining_domains").text(JSON.stringify(domainsOfInterest));
                    if (frequencyDictList) {
                        for(let i=0; i < result.length; i++) {
                            for(let dom in result[i]) {
                                frequencyDictList[i][dom] = result[i][dom];
                        }
                    } else {
                        frequncyDictList = result; //['body']?
                    $("#results").text(JSON.stringify(frequencyDictList));
                },
                error: function(result, statusText, xhr) {
                    $("#results").text(JSON.stringify(result));
                },
            });
            
        });
        
    </script>
    
{% endblock %}

{% block body %}
    Loading...
    <p id="remaining_domains">{{ domains_of_interest|safe }}</p>
    <p id="results"></p>
{% endblock %}



{% block body_attributes %}
{% endblock %}