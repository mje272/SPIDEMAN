{% extends 'base.html' %}


{% block head %}
    <title>Loading Histogram</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="jquery-3.7.1.min.js"></script>
    
    <script>
        const speciesList = {{ species_list|safe }};
        const fitOnScreen = '{{ fit_on_screen|safe }}';
        const searchTerm = '{{ search_term|safe }}';
        var domainsOfInterest = {{ domains_of_interest|safe }};
        const domainTotal = domainsOfInterest.length;
        var frequencyDictList;
        
        function incrementalLoad() {
            $(document).ready(function(){
                $.ajax({
                    url: "https://zr25ojb4do7qu6usoihbljlhbe0vcsif.lambda-url.us-west-1.on.aws/",
                    processData: false,
                    crossDomain: true,
                    type: "POST",
                    data: JSON.stringify({
                        species_selection: speciesList,
                        domain: domainsOfInterest.pop(),
                    }),
                    cache: false,
                    processData: false,
                    success: function(result){
                        $("#remaining_domains").text(JSON.stringify(domainsOfInterest));
                        if (frequencyDictList) {
                            for(let i=0; i < result.length; i++) {
                                for(let dom in result[i]) {
                                    frequencyDictList[i][dom] = result[i][dom];
                                }
                            }
                        } else {
                            frequencyDictList = result;
                        } 
                        $("#results").text(JSON.stringify(frequencyDictList));
                        if (domainsOfInterest.length) {
                            $("#remainingCount").text(JSON.stringify(result) + "/" + JSON.stringify(domainTotal));
                            incrementalLoad();
                        } else {
                            var sums = "";
                            for(let species in result) {
                                let species_sum = 0;
                                for(let dom in species) {
                                    
                                    species_sum += species[dom];
                                }
                                sums += JSON.stringify(species_sum) + " ";
                            }
                            $("#final_sums").text(sums);
                        }
                    },
                    error: function(result, statusText, xhr) {
                        $("#results").text(JSON.stringify(result));
                    },
                });
            });
        }

        incrementalLoad();

    </script>
    
{% endblock %}

{% block body %}
    Loading...
    <p id="remaining_domains">{{ domains_of_interest|safe }}</p>
    <p id="results"></p>
    <p id="remaining_count"></p>
    <p id="final_sums"></p>
{% endblock %}



{% block body_attributes %}
{% endblock %}